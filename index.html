<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Sandbox Simulator - Epic Version</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    font-family: sans-serif;
    color: white;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 10px;
    z-index: 10;
  }
  button, input[type=range] {
    margin: 5px 0;
    cursor: pointer;
  }
  button.active {
    background: #1b3558;
    color: white;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
  <button data-type="planet">Planet</button>
  <button data-type="blackhole">Black Hole</button>
  <button id="reset">Reset</button><br>
  Gravitation: <input type="range" min="0" max="1" step="0.01" id="gravSlider" value="0.25">
</div>

<script>
console.log("SELECTIVE GRAVITY EPIC LOADED");

const c = document.getElementById("c");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

let mode = null;
let G = parseFloat(document.getElementById("gravSlider").value);

const planets = [];
const blackholes = [];
const rockets = [];

// ===== STARS LAGER FÖR PARALLAX =====
const starsLayers = [[],[],[]]; // 3 lager: 0=nära, 2=långt bort

ctx.imageSmoothingEnabled = true;

// ===== BAS-KLASS =====
class Body {
  constructor(x,y,mass){
    this.x=x; this.y=y;
    this.vx=0; this.vy=0;
    this.mass=mass;
  }
  pullFrom(bh){
    const dx = bh.x - this.x;
    const dy = bh.y - this.y;
    const d = Math.sqrt(dx*dx + dy*dy) + 0.5;
    const f = G * bh.mass / (d*d);
    this.vx += dx/d * f;
    this.vy += dy/d * f;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
  }
}

// ===== STAR =====
class Star extends Body{
  constructor(layer){
    super(Math.random()*c.width,Math.random()*c.height,1);
    this.size=Math.random()*1.5+0.5;
    this.layer = layer; // 0=nära, 1=medium, 2=långt bort
    this.color = ["#fff", "#ffea00", "#9fdfff"][Math.floor(Math.random()*3)];
  }
  update(){
    // gravitation påverkar mest nära lager
    blackholes.forEach(bh=>{
      let weight = (3-this.layer)/3; // närmare lager påverkas mer
      const dx = bh.x - this.x;
      const dy = bh.y - this.y;
      const d = Math.sqrt(dx*dx + dy*dy) + 0.5;
      const f = G * bh.mass / (d*d) * weight;
      this.vx += dx/d * f;
      this.vy += dy/d * f;
    });
    super.update();
    // wrap around
    if(this.x<0) this.x=c.width;
    if(this.x>c.width) this.x=0;
    if(this.y<0) this.y=c.height;
    if(this.y>c.height) this.y=0;
  }
  draw(){
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== PLANET =====
class Planet extends Body{
  constructor(x,y){
    super(x,y,600);
    this.r=18;
    this.trail = [];
  }
  update(){
    blackholes.forEach(bh=>this.pullFrom(bh));
    super.update();
    // trail
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>20) this.trail.shift();
    // collision med svart hål
    blackholes.forEach(bh=>{
      const dx = bh.x - this.x;
      const dy = bh.y - this.y;
      if(Math.sqrt(dx*dx + dy*dy) < bh.r){
        planets.splice(planets.indexOf(this),1);
      }
    });
  }
  draw(){
    // trail
    ctx.strokeStyle = "rgba(127,212,255,0.4)";
    ctx.beginPath();
    for(let i=0;i<this.trail.length;i++){
      const p=this.trail[i];
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();
    // planet
    const g = ctx.createRadialGradient(this.x-6,this.y-6,4,this.x,this.y,this.r);
    g.addColorStop(0,"#7fd4ff");
    g.addColorStop(1,"#1b3558");
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== BLACK HOLE =====
class BlackHole{
  constructor(x,y){
    this.x=x; this.y=y;
    this.mass=3000;
    this.r=35;
    this.pulse = 0;
  }
  draw(){
    // svart hål
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();
    // pulserande ljusring
    this.pulse += 0.05;
    ctx.strokeStyle = `rgba(255,255,255,${0.25 + Math.sin(this.pulse)*0.1})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r+10,0,Math.PI*2);
    ctx.stroke();
  }
}

// ===== ROCKET =====
class Rocket extends Body{
  constructor(){
    super(-100,Math.random()*c.height,200);
    this.vx=2;
    this.trail=[];
  }
  update(){
    blackholes.forEach(bh=>this.pullFrom(bh));
    super.update();
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>15) this.trail.shift();
    if(this.x>c.width+200){
      this.x=-200;
      this.y=Math.random()*c.height;
      this.vx=2; this.vy=0;
      this.trail=[];
    }
  }
  draw(){
    ctx.strokeStyle="orange";
    ctx.beginPath();
    for(let i=0;i<this.trail.length;i++){
      const p=this.trail[i];
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();
    ctx.fillStyle="white";
    ctx.fillRect(this.x,this.y,30,6);
    ctx.fillStyle="orange";
    ctx.fillRect(this.x-8,this.y+1,6,4);
  }
}

// ===== INIT STJÄRNOR =====
function initStars(){
  for(let layer=0;layer<3;layer++){
    starsLayers[layer].length = 0;
    for(let i=0;i<1000/3;i++){
      starsLayers[layer].push(new Star(layer));
    }
  }
}

// INIT
initStars();
rockets.push(new Rocket());

// MENU-KNAPPR
document.querySelectorAll("button[data-type]").forEach(b => {
  b.addEventListener("click", e => {
    document.querySelectorAll("button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    mode = b.dataset.type;
    e.stopPropagation();
  });
});

// RESET
document.getElementById("reset").addEventListener("click", e => {
  planets.length = 0;
  blackholes.length = 0;
  mode = null;
  document.querySelectorAll("button").forEach(x => x.classList.remove("active"));
  initStars();
  e.stopPropagation();
});

// Gravitation-slider
document.getElementById("gravSlider").addEventListener("input", e => {
  G = parseFloat(e.target.value);
});

// CANVAS-KLICK
c.addEventListener("click", e => {
  if(e.clientX < 220 && e.clientY < 150) return;
  if(mode === "planet") planets.push(new Planet(e.clientX, e.clientY));
  if(mode === "blackhole") blackholes.push(new BlackHole(e.clientX, e.clientY));
});

// RESIZE
addEventListener("resize",()=>{
  c.width=innerWidth;
  c.height=innerHeight;
});

// LOOP
function loop(){
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,c.width,c.height);

  starsLayers.forEach(layer=>{
    layer.forEach(s=>{
      s.update();
      s.draw();
    });
  });

  planets.forEach(p=>{
    p.update();
    p.draw();
  });

  rockets.forEach(r=>{
    r.update();
    r.draw();
  });

  blackholes.forEach(bh=>bh.draw());

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
