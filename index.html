<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Market Simulator</title>

<style>
:root{
--bg:#0b0f14;--panel:#111827;--border:#1f2937;
--text:#e5e7eb;--muted:#9ca3af;
--green:#22c55e;--red:#ef4444;
}

*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}

header{
display:flex;justify-content:space-between;align-items:center;
padding:20px 30px;border-bottom:1px solid var(--border)
}

main{padding:30px;max-width:1200px;margin:auto}

.market,.portfolio{
background:var(--panel);
border:1px solid var(--border);
border-radius:10px;
margin-bottom:30px;
overflow:hidden
}

.market-header,.row{
display:grid;
grid-template-columns:1.5fr 1fr 1fr 1fr 1fr 1fr;
padding:14px 15px;
align-items:center
}

.market-header{
background:#0f172a;font-size:13px;color:var(--muted);
text-transform:uppercase
}

.row{border-top:1px solid var(--border);cursor:pointer}
.row:hover{background:#020617}

input{
width:60px;background:#020617;border:1px solid var(--border);
color:white;padding:5px;border-radius:5px
}

button{
padding:6px 10px;border:none;border-radius:6px;
cursor:pointer;font-weight:600
}

.buy{background:var(--green);color:black}
.sell{background:var(--red);color:black}

.green{color:var(--green)}
.red{color:var(--red)}

.stats span{margin-left:20px;font-weight:600}

/* MODAL */
.modal{
position:fixed;inset:0;
background:rgba(0,0,0,0.7);
display:none;align-items:center;justify-content:center
}

.modal-content{
background:var(--panel);
border:1px solid var(--border);
border-radius:12px;
width:700px;
padding:20px
}

.modal-header{
display:flex;justify-content:space-between;align-items:center
}

.close{
cursor:pointer;color:var(--muted)
}

canvas{width:100%;height:300px;margin-top:20px}
</style>
</head>

<body>

<header>
<h1>DARK MARKET</h1>
<div class="stats">
<span>Cash: $<span id="cash"></span></span>
<span>Portfolio Value: $<span id="value"></span></span>
<span>P/L: <span id="pl"></span></span>
</div>
</header>

<main>

<div class="market">
<div class="market-header">
<div>Company</div><div>Price</div><div>Change</div>
<div>Shares</div><div>Buy</div><div>Sell</div>
</div>
<div id="stocks"></div>
</div>

<div class="portfolio">
<div class="market-header">
<div>Holding</div><div>Shares</div><div>Avg</div>
<div>Current</div><div>Value</div><div>P/L</div>
</div>
<div id="portfolio"></div>
</div>

</main>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">
<div class="modal-header">
<h3 id="modalTitle"></h3>
<span class="close" onclick="closeModal()">✕</span>
</div>
<canvas id="chart"></canvas>
</div>
</div>

<script>
let cash=100000;
let portfolio={};

let stocks=[
{ticker:"NXAI",name:"Nexora AI",price:142,history:[]},
{ticker:"BLKW",name:"Blackwave Industries",price:87,history:[]},
{ticker:"VRTX",name:"Vertex Dynamics",price:59,history:[]},
{ticker:"OMNI",name:"OmniCore Systems",price:212,history:[]},
{ticker:"CYBR",name:"Cyberion Security",price:134,history:[]},
{ticker:"AETH",name:"Aether Energy",price:73,history:[]}
];

const ctx=document.getElementById("chart").getContext("2d");

function renderStocks(){
const s=document.getElementById("stocks");
s.innerHTML="";
stocks.forEach(stock=>{
let change=(Math.random()*4-2);
stock.price*=1+change/100;
stock.history.push(stock.price);
if(stock.history.length>50)stock.history.shift();

s.innerHTML+=`
<div class="row" onclick="openModal('${stock.ticker}')">
<div>${stock.ticker} <span style="color:gray;font-size:12px">${stock.name}</span></div>
<div>$${stock.price.toFixed(2)}</div>
<div class="${change>=0?'green':'red'}">${change.toFixed(2)}%</div>
<div><input type="number" min="1" value="1" id="qty-${stock.ticker}"></div>
<div><button class="buy" onclick="event.stopPropagation();buy('${stock.ticker}')">Buy</button></div>
<div><button class="sell" onclick="event.stopPropagation();sell('${stock.ticker}')">Sell</button></div>
</div>`;
});
}

function buy(t){
let s=stocks.find(x=>x.ticker===t);
let q=+document.getElementById("qty-"+t).value;
let cost=s.price*q;
if(cost>cash)return alert("Not enough cash");
cash-=cost;
portfolio[t]=portfolio[t]||{shares:0,cost:0};
portfolio[t].shares+=q;
portfolio[t].cost+=cost;
updateUI();
}

function sell(t){
if(!portfolio[t])return;
let s=stocks.find(x=>x.ticker===t);
let q=+document.getElementById("qty-"+t).value;
if(q>portfolio[t].shares)return alert("Not enough shares");
cash+=s.price*q;
portfolio[t].shares-=q;
portfolio[t].cost*=portfolio[t].shares/(portfolio[t].shares+q);
if(portfolio[t].shares===0)delete portfolio[t];
updateUI();
}

function updateUI(){
document.getElementById("cash").innerText=cash.toFixed(2);
let p=document.getElementById("portfolio");
p.innerHTML="";
let total=0,cost=0;
for(let t in portfolio){
let s=stocks.find(x=>x.ticker===t);
let v=s.price*portfolio[t].shares;
let pl=v-portfolio[t].cost;
total+=v;cost+=portfolio[t].cost;
p.innerHTML+=`
<div class="row">
<div>${t}</div>
<div>${portfolio[t].shares}</div>
<div>$${(portfolio[t].cost/portfolio[t].shares).toFixed(2)}</div>
<div>$${s.price.toFixed(2)}</div>
<div>$${v.toFixed(2)}</div>
<div class="${pl>=0?'green':'red'}">$${pl.toFixed(2)}</div>
</div>`;
}
document.getElementById("value").innerText=total.toFixed(2);
let pl=total-cost;
document.getElementById("pl").innerHTML=
`<span class="${pl>=0?'green':'red'}">$${pl.toFixed(2)}</span>`;
}

function openModal(t){
let s=stocks.find(x=>x.ticker===t);
document.getElementById("modalTitle").innerText=
`${s.ticker} — ${s.name}`;
document.getElementById("modal").style.display="flex";
drawChart(s.history);
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

function drawChart(data){
ctx.clearRect(0,0,700,300);
ctx.strokeStyle="#22c55e";
ctx.beginPath();
data.forEach((p,i)=>{
let x=i*(700/data.length);
let y=300-(p/Math.max(...data))*260-20;
if(i===0)ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});
ctx.stroke();
}

setInterval(()=>{
renderStocks();
updateUI();
},3000);

renderStocks();
updateUI();
</script>

</body>
</html>
