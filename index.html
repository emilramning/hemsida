<script>
console.log("SELECTIVE GRAVITY LOADED");

const c = document.getElementById("c");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

let mode = null;
const stars = [];
const planets = [];
const blackholes = [];
const rockets = [];

const G = 0.25;

// ===== BAS-KLASS =====
class Body {
  constructor(x,y,mass){
    this.x=x; this.y=y;
    this.vx=0; this.vy=0;
    this.mass=mass;
  }
  pullFrom(bh){
    const dx = bh.x - this.x;
    const dy = bh.y - this.y;
    const d = Math.sqrt(dx*dx + dy*dy) + 0.5;
    const f = G * bh.mass / (d*d);
    this.vx += dx/d * f;
    this.vy += dy/d * f;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
  }
}

// ===== STAR =====
class Star extends Body{
  constructor(){
    super(Math.random()*c.width,Math.random()*c.height,1);
    this.size=Math.random()*1.5+0.5;
  }
  draw(){
    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== PLANET (STATISK) =====
class Planet extends Body{
  constructor(x,y){
    super(x,y,600);
    this.r=18;
  }
  update(){
    // rör sig ENDAST om svart hål finns
    blackholes.forEach(bh=>this.pullFrom(bh));
    this.x+=this.vx;
    this.y+=this.vy;
  }
  draw(){
    const g = ctx.createRadialGradient(this.x-6,this.y-6,4,this.x,this.y,this.r);
    g.addColorStop(0,"#7fd4ff");
    g.addColorStop(1,"#1b3558");
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== BLACK HOLE =====
class BlackHole{
  constructor(x,y){
    this.x=x; this.y=y;
    this.mass=3000;
    this.r=35;
  }
  draw(){
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();

    ctx.strokeStyle="rgba(255,255,255,0.25)";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r+10,0,Math.PI*2);
    ctx.stroke();
  }
}

// ===== ROCKET =====
class Rocket extends Body{
  constructor(){
    super(-100,Math.random()*c.height,200);
    this.vx=2;
  }
  update(){
    blackholes.forEach(bh=>this.pullFrom(bh));
    super.update();
  }
  draw(){
    ctx.fillStyle="white";
    ctx.fillRect(this.x,this.y,30,6);
    ctx.fillStyle="orange";
    ctx.fillRect(this.x-8,this.y+1,6,4);
  }
}

// INIT
for(let i=0;i<1000;i++) stars.push(new Star());
rockets.push(new Rocket());

// MENU
document.querySelectorAll("button[data-type]").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    mode=b.dataset.type;
  };
});

document.getElementById("reset").onclick=()=>{
  planets.length=0;
  blackholes.length=0;
};

addEventListener("click",e=>{
  if(e.clientX>c.width-200) return;
  if(mode==="planet") planets.push(new Planet(e.clientX,e.clientY));
  if(mode==="blackhole") blackholes.push(new BlackHole(e.clientX,e.clientY));
});

addEventListener("resize",()=>{
  c.width=innerWidth;
  c.height=innerHeight;
});

// LOOP
function loop(){
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,c.width,c.height);

  stars.forEach(s=>{
    blackholes.forEach(bh=>s.pullFrom(bh));
    s.update();
    s.draw();
  });

  planets.forEach(p=>{
    p.update();
    p.draw();
  });

  rockets.forEach(r=>{
    r.update();
    r.draw();
    if(r.x>c.width+200){
      r.x=-200;
      r.y=Math.random()*c.height;
      r.vx=2; r.vy=0;
    }
  });

  blackholes.forEach(bh=>bh.draw());

  requestAnimationFrame(loop);
}
loop();
</script>
