<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Market</title>

<style>
:root{
--bg:#0b0f14;
--panel:#111827;
--border:#1f2937;
--text:#e5e7eb;
--green:#22c55e;
--red:#ef4444;
--muted:#9ca3af;
}

*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}

header{
display:flex;
justify-content:space-between;
padding:20px;
border-bottom:1px solid var(--border);
}

main{padding:30px;max-width:1200px;margin:auto}

.market,.portfolio{
background:var(--panel);
border:1px solid var(--border);
border-radius:10px;
margin-bottom:30px;
overflow:hidden;
}

.market-header,.row{
display:grid;
grid-template-columns:1.5fr 1fr 1fr 1fr 1fr 1fr;
padding:14px;
align-items:center;
}

.market-header{
background:#0f172a;
font-size:13px;
color:var(--muted);
text-transform:uppercase;
}

.row{
border-top:1px solid var(--border);
cursor:pointer;
}

.row:hover{background:#020617}

input{
width:60px;
background:#020617;
border:1px solid var(--border);
color:white;
padding:5px;
border-radius:5px;
}

button{
padding:6px 10px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:600;
}

.buy{background:var(--green);color:black}
.sell{background:var(--red);color:black}
.green{color:var(--green)}
.red{color:var(--red)}

/* MODAL */
.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,0.7);
display:none;
align-items:center;
justify-content:center;
}

.modal-content{
background:var(--panel);
border:1px solid var(--border);
border-radius:12px;
width:750px;
padding:20px;
}

canvas{
width:100%;
height:300px;
}
</style>
</head>
<body>

<header>
<h2>DARK MARKET</h2>
<div>
Cash: $<span id="cash">100000</span> |
Portfolio: $<span id="value">0</span> |
P/L: <span id="pl">$0</span>
</div>
</header>

<main>

<div class="market">
<div class="market-header">
<div>Company</div>
<div>Price</div>
<div>Change</div>
<div>Qty</div>
<div>Buy</div>
<div>Sell</div>
</div>
<div id="stocks"></div>
</div>

<div class="portfolio">
<div class="market-header">
<div>Holding</div>
<div>Shares</div>
<div>Avg</div>
<div>Current</div>
<div>Value</div>
<div>P/L</div>
</div>
<div id="portfolio"></div>
</div>

</main>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">
<h3 id="modalTitle"></h3>
<canvas id="chart" width="700" height="300"></canvas>
<br>
<button onclick="closeModal()">Close</button>
</div>
</div>

<script>

/* ========= HISTORIK ========= */
function generateHistory(startPrice, points=80){
let history=[];
let price=startPrice;
for(let i=0;i<points;i++){
let change=(Math.random()*4-2);
price*=1+change/100;
history.push(price);
}
return history;
}

/* ========= DATA ========= */
let cash=100000;
let portfolio={};

let stocks=[
{ticker:"NXAI",name:"Nexora AI",price:140,history:generateHistory(140)},
{ticker:"BLKW",name:"Blackwave Industries",price:90,history:generateHistory(90)},
{ticker:"VRTX",name:"Vertex Dynamics",price:60,history:generateHistory(60)},
{ticker:"OMNI",name:"OmniCore Systems",price:210,history:generateHistory(210)},
{ticker:"CYBR",name:"Cyberion Security",price:130,history:generateHistory(130)},
{ticker:"AETH",name:"Aether Energy",price:75,history:generateHistory(75)}
];

/* ========= RENDER ========= */
function renderStocks(){
let container=document.getElementById("stocks");
container.innerHTML="";

stocks.forEach(stock=>{
let change=(Math.random()*4-2);
stock.price*=1+change/100;

stock.history.push(stock.price);
if(stock.history.length>120) stock.history.shift();

container.innerHTML+=`
<div class="row" onclick="openModal('${stock.ticker}')">
<div>${stock.ticker} <span style="color:gray;font-size:12px">${stock.name}</span></div>
<div>$${stock.price.toFixed(2)}</div>
<div class="${change>=0?'green':'red'}">${change.toFixed(2)}%</div>
<div><input type="number" min="1" value="1" id="qty-${stock.ticker}"></div>
<div><button class="buy" onclick="event.stopPropagation();buy('${stock.ticker}')">Buy</button></div>
<div><button class="sell" onclick="event.stopPropagation();sell('${stock.ticker}')">Sell</button></div>
</div>
`;
});
}

/* ========= BUY/SELL ========= */
function buy(t){
let s=stocks.find(x=>x.ticker===t);
let q=parseInt(document.getElementById("qty-"+t).value);
let cost=s.price*q;
if(cost>cash) return alert("Not enough cash");
cash-=cost;
portfolio[t]=portfolio[t]||{shares:0,cost:0};
portfolio[t].shares+=q;
portfolio[t].cost+=cost;
updateUI();
}

function sell(t){
if(!portfolio[t]) return;
let s=stocks.find(x=>x.ticker===t);
let q=parseInt(document.getElementById("qty-"+t).value);
if(q>portfolio[t].shares) return alert("Not enough shares");

cash+=s.price*q;
let avg=portfolio[t].cost/portfolio[t].shares;
portfolio[t].shares-=q;
portfolio[t].cost-=avg*q;

if(portfolio[t].shares===0) delete portfolio[t];
updateUI();
}

/* ========= PORTFOLIO ========= */
function updateUI(){
document.getElementById("cash").innerText=cash.toFixed(2);

let p=document.getElementById("portfolio");
p.innerHTML="";
let total=0;
let totalCost=0;

for(let t in portfolio){
let s=stocks.find(x=>x.ticker===t);
let value=s.price*portfolio[t].shares;
let pl=value-portfolio[t].cost;
total+=value;
totalCost+=portfolio[t].cost;

p.innerHTML+=`
<div class="row">
<div>${t}</div>
<div>${portfolio[t].shares}</div>
<div>$${(portfolio[t].cost/portfolio[t].shares).toFixed(2)}</div>
<div>$${s.price.toFixed(2)}</div>
<div>$${value.toFixed(2)}</div>
<div class="${pl>=0?'green':'red'}">$${pl.toFixed(2)}</div>
</div>
`;
}

document.getElementById("value").innerText=total.toFixed(2);
let totalPL=total-totalCost;
document.getElementById("pl").innerHTML=
`<span class="${totalPL>=0?'green':'red'}">$${totalPL.toFixed(2)}</span>`;
}

/* ========= CHART ========= */
function openModal(t){
let s=stocks.find(x=>x.ticker===t);
document.getElementById("modalTitle").innerText=
`${s.ticker} - ${s.name}`;
document.getElementById("modal").style.display="flex";
drawChart(s.history);
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

function drawChart(data){
let canvas=document.getElementById("chart");
let ctx=canvas.getContext("2d");

ctx.clearRect(0,0,canvas.width,canvas.height);

let min=Math.min(...data);
let max=Math.max(...data);
let range=max-min;

ctx.beginPath();
ctx.strokeStyle="#22c55e";
ctx.lineWidth=2;

data.forEach((price,i)=>{
let x=i*(canvas.width/data.length);
let y=canvas.height-((price-min)/range)*(canvas.height-40)-20;
if(i===0) ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});

ctx.stroke();
}

/* ========= LOOP ========= */
setInterval(()=>{
renderStocks();
updateUI();
},3000);

renderStocks();
updateUI();

</script>

</body>
</html>
