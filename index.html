<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Sandbox Simulator</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    font-family: sans-serif;
    color: white;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 10px;
    z-index: 10;
  }
  button, input[type=range] {
    margin: 5px 0;
    cursor: pointer;
  }
  button.active {
    background: #1b3558;
    color: white;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
  <button data-type="planet">Planet</button>
  <button data-type="blackhole">Black Hole</button>
  <button id="reset">Reset</button><br>
  Gravitation: <input type="range" min="0" max="1" step="0.01" id="gravSlider" value="0.25">
</div>

<script>
console.log("SELECTIVE GRAVITY LOADED");

const c = document.getElementById("c");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

let mode = null;
let G = parseFloat(document.getElementById("gravSlider").value);

const stars = [];
const planets = [];
const blackholes = [];
const rockets = [];

ctx.imageSmoothingEnabled = true;

// ===== BAS-KLASS =====
class Body {
  constructor(x,y,mass){
    this.x=x; this.y=y;
    this.vx=0; this.vy=0;
    this.mass=mass;
  }
  pullFrom(bh){
    const dx = bh.x - this.x;
    const dy = bh.y - this.y;
    const d = Math.sqrt(dx*dx + dy*dy) + 0.5;
    const f = G * bh.mass / (d*d);
    this.vx += dx/d * f;
    this.vy += dy/d * f;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
  }
}

// ===== STAR =====
class Star extends Body{
  constructor(){
    super(Math.random()*c.width,Math.random()*c.height,1);
    this.size=Math.random()*1.5+0.5;
    this.color = ["#fff", "#ffea00", "#9fdfff"][Math.floor(Math.random()*3)];
  }
  draw(){
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== PLANET (med slumpad färg och storlek) =====
class Planet extends Body{
  constructor(x,y){
    super(x,y,600);
    this.r = 10 + Math.random()*20; // slumpad radie
    this.trail = [];
    // slumpad färggradient
    const colors = [
      ["#7fd4ff","#1b3558"],   // blå planet
      ["#ff7f50","#8b2d00"],   // röd planet
      ["#7fff7f","#0b3d0b"],   // grön planet
      ["#d47fff","#3b003b"],   // lila planet
      ["#ffd700","#8b6f00"]    // gul planet
    ];
    this.color = colors[Math.floor(Math.random()*colors.length)];
  }
  update(){
    blackholes.forEach(bh=>this.pullFrom(bh));
    super.update();
    // trail
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>20) this.trail.shift();
    // kolla collision med svart hål
    blackholes.forEach(bh=>{
      const dx = bh.x - this.x;
      const dy = bh.y - this.y;
      if(Math.sqrt(dx*dx + dy*dy) < bh.r){
        planets.splice(planets.indexOf(this),1);
      }
    });
  }
  draw(){
    // trail
    ctx.strokeStyle = "rgba(127,212,255,0.4)";
    ctx.beginPath();
    for(let i=0;i<this.trail.length;i++){
      const p=this.trail[i];
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();

    // planet
    const g = ctx.createRadialGradient(this.x-6,this.y-6,4,this.x,this.y,this.r);
    g.addColorStop(0,this.color[0]);
    g.addColorStop(1,this.color[1]);
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();
  }
}

// ===== BLACK HOLE =====
class BlackHole{
  constructor(x,y){
    this.x=x; this.y=y;
    this.mass=3000;
    this.r=35;
  }
  draw(){
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();

    ctx.strokeStyle="rgba(255,255,255,0.25)";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r+10,0,Math.PI*2);
    ctx.stroke();
  }
}

// ===== ROCKET =====
class Rocket extends Body{
  constructor(){
    super(-100,Math.random()*c.height,200);
    this.vx=2;
    this.trail=[];
  }
  update(){
    blackholes.forEach(bh=>this.pullFrom(bh));
    super.update();
    // trail
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>15) this.trail.shift();
    if(this.x>c.width+200){
      this.x=-200;
      this.y=Math.random()*c.height;
      this.vx=2; this.vy=0;
      this.trail=[];
    }
  }
  draw(){
    // trail
    ctx.strokeStyle="orange";
    ctx.beginPath();
    for(let i=0;i<this.trail.length;i++){
      const p=this.trail[i];
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();

    ctx.fillStyle="white";
    ctx.fillRect(this.x,this.y,30,6);
    ctx.fillStyle="orange";
    ctx.fillRect(this.x-8,this.y+1,6,4);
  }
}

// ===== INIT FUNKTION FÖR STJÄRNOR =====
function initStars(){
  stars.length = 0;
  for(let i=0;i<1000;i++){
    stars.push(new Star());
  }
}

// INIT
initStars();
rockets.push(new Rocket());

// MENU-KNAPPR
document.querySelectorAll("button[data-type]").forEach(b => {
  b.addEventListener("click", e => {
    document.querySelectorAll("button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    mode = b.dataset.type;
    e.stopPropagation();
  });
});

// RESET
document.getElementById("reset").addEventListener("click", e => {
  planets.length = 0;
  blackholes.length = 0;
  mode = null;
  document.querySelectorAll("button").forEach(x => x.classList.remove("active"));
  initStars(); // Återskapa stjärnor
  e.stopPropagation();
});

// Gravitation-slider
document.getElementById("gravSlider").addEventListener("input", e => {
  G = parseFloat(e.target.value);
});

// CANVAS-KLICK
c.addEventListener("click", e => {
  // ignorera UI-området
  if(e.clientX < 220 && e.clientY < 150) return;

  if(mode === "planet") planets.push(new Planet(e.clientX, e.clientY));
  if(mode === "blackhole") blackholes.push(new BlackHole(e.clientX, e.clientY));
});

// RESIZE
addEventListener("resize",()=>{
  c.width=innerWidth;
  c.height=innerHeight;
});

// LOOP
function loop(){
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,c.width,c.height);

  stars.forEach(s=>{
    blackholes.forEach(bh=>s.pullFrom(bh));
    s.update();
    s.draw();
  });

  planets.forEach(p=>{
    p.update();
    p.draw();
  });

  rockets.forEach(r=>{
    r.update();
    r.draw();
  });

  blackholes.forEach(bh=>bh.draw());

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
